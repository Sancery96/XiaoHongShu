# 案例处理系统使用说明

## 环境准备

### 1. 安装Python依赖
```bash
pip install -r requirements.txt
```

### 2. 安装FFmpeg
- **Windows**: 下载FFmpeg并添加到系统PATH，或在`config.py`中指定完整路径
- **验证安装**: 在命令行运行 `ffmpeg -version`

### 3. 配置API密钥
编辑 `config.py` 文件，替换以下内容：
```python
DEEPSEEK_API_KEY = "your-deepseek-api-key-here"  # 改为你的真实密钥
```

## 文件结构
```
D:\曲曲直播录屏\2025\2025-11\
├── 2025-11-06.mp4           # 原始视频文件
├── 2025-11-27.mp4
├── 2025-11-28.mp4
├── 2025-11.docx             # 文字稿文档
├── config.py                # 配置文件
├── main.py                  # 主脚本
├── requirements.txt         # 依赖清单
├── progress.json            # 进度记录（自动生成）
├── 案例汇总.csv             # 输出结果（自动生成）
└── Splits\                  # 分割后的视频（自动生成）
    ├── 2025-11-06\
    │   ├── 2025110601.mp4
    │   └── 2025110602.mp4
    ├── 2025-11-27\
    └── 2025-11-28\
```

## 运行方式

### 首次运行
```bash
python main.py
```

### 断点续传
程序会自动跳过已完成的案例，继续处理未完成的部分：
- 如果程序中途退出，直接再次运行 `python main.py` 即可
- 进度记录保存在 `progress.json` 文件中
- 如果某个案例处理到一半退出，下次会重新处理该案例

### 重新处理所有案例
删除 `progress.json` 和 `案例汇总.csv`，然后运行：
```bash
python main.py
```

## 处理流程

每个案例的处理步骤：
1. ✓ 解析Word文档提取案例内容
2. ✓ 调用DeepSeek清洗文字稿
3. ✓ 调用DeepSeek生成标题、分类、标签、适用人群和场景
4. ✓ 使用FFmpeg分割视频
5. ✓ 保存结果到CSV文件
6. ✓ 更新进度记录

## 输出说明

### CSV文件列说明
| 列名 | 说明 | 示例 |
|------|------|------|
| 案例编号 | 格式：YYYYMMDDNN | 2025110601 |
| 日期 | 案例日期 | 2025-11-06 |
| 案例标题 | 30字以内概括 | 高净值博主在家族企业转型... |
| 一级分类 | 主分类 | 职业发展 |
| 二级分类 | 细分类 | 家族企业 |
| 标签 | 5-8个关键词，以"、"分隔 | 高净值、创业、27岁、事业转型 |
| 起始时间 | 格式：MM:SS 或 HH:MM:SS | 11:38 |
| 结束时间 | 下一个案例的开始时间 | 26:08 |
| 适用人群 | 目标读者描述 | 高净值女性、创业者、面临... |
| 适用场景 | 参考场景描述 | 家族企业转型期、个人事业... |
| 原始文字稿 | 从Word提取的原始内容 | ... |
| 清洗后文字稿 | DeepSeek清洗后的内容 | ... |
| 视频文件路径 | 分割后视频的完整路径 | D:\...\2025110601.mp4 |

## 常见问题

### Q1: 如果某个案例处理失败怎么办？
A: 程序会停止并显示错误信息。修复问题后重新运行，会自动跳过已完成的案例。

### Q2: 如何查看处理进度？
A: 查看 `progress.json` 文件，或观察控制台输出。

### Q3: 视频分割后原视频会被删除吗？
A: 不会，原视频完全保留，分割后的视频保存在 `Splits` 目录下。

### Q4: DeepSeek API调用频率限制？
A: 程序已内置重试机制（最多3次），如果遇到频率限制，可以在两次运行之间等待一段时间。

### Q5: 如何修改分类标准？
A: 编辑 `main.py` 中 `generate_metadata()` 函数的提示词部分。

## 注意事项

1. **API密钥安全**: 不要将 `config.py` 上传到公开代码仓库
2. **磁盘空间**: 确保有足够空间存储分割后的视频
3. **网络连接**: 处理过程需要稳定的网络连接DeepSeek API
4. **FFmpeg路径**: 如果FFmpeg不在系统PATH中，需在config.py中指定完整路径
5. **Word文档格式**: 确保文档格式与示例一致，案例标记为 `## 案例`

## 技术支持

如有问题，检查以下内容：
- Python版本 >= 3.7
- 依赖包是否正确安装
- FFmpeg是否可用
- DeepSeek API密钥是否有效
- Word文档格式是否正确
